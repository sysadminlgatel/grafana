{"version":3,"sources":["../src/ctrl.js"],"names":["getColorForValue","data","value","i","thresholds","length","colorMap","_","first","MetricsPanelCtrl","$","kbn","config","TimeSeries","d3","panelDefaults","fontSizes","fontTypes","unitFormats","getUnitFormats","operatorNameOptions","valueMaps","op","text","mappingTypes","name","rangeMaps","from","to","mappingType","colors","decimals","format","operatorName","gauge","minValue","maxValue","tickSpaceMinVal","tickSpaceMajVal","gaugeUnits","gaugeRadius","pivotRadius","padding","edgeWidth","tickEdgeGap","tickLengthMaj","tickLengthMin","needleTickGap","needleLengthNeg","ticknessGaugeBasis","needleWidth","tickWidthMaj","tickWidthMin","unitsLabelFontSize","labelFontSize","zeroTickAngle","maxTickAngle","zeroNeedleAngle","maxNeedleAngle","outerEdgeCol","innerCol","pivotCol","needleCol","unitsLabelCol","tickLabelCol","tickColMaj","tickColMin","tickFont","unitsFont","showThresholdOnGauge","showThresholdColorOnValue","showLowerThresholdRange","showMiddleThresholdRange","showUpperThresholdRange","animateNeedleValueTransition","D3GaugePanelCtrl","$scope","$injector","alertSrv","defaults","panel","gaugeDivId","id","scoperef","alertSrvRef","initialized","panelContainer","svg","panelWidth","panelHeight","gaugeObject","valueFormatted","valueRounded","series","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","panels","grafanaBootData","settings","thisPanel","pluginId","thisPanelPath","baseUrl","optionsPath","addEditorTab","radialMetricsPath","thresholdingPath","mappingsPath","container","tmpPanelWidth","clientWidth","getPanelHeight","actualWidth","tmpPanelHeight","ctrl","height","row","replace","actualHeight","parseInt","remove","setValues","clearSVG","getPanelWidth","margin","top","right","bottom","left","width","select","append","attr","classed","tmpGaugeRadius","parseFloat","opt","minVal","maxVal","thresholdColors","needleValText","getValueText","needleVal","getValueRounded","drawGauge","map","index","indexOf","splice","render","push","rangeMap","isNaN","set","scope","elem","attrs","setContainer","find","renderedSVG","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","flotpairs","error","Error","message","JSON","stringify","lastPoint","last","datapoints","lastValue","isArray","alias","isString","escape","stats","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","roundValue","scopedVars","__name","label","j","subItem","err","dataList","seriesHandler","updateGauge","seriesData","target","getFlotPairs","nullPointMode","tmp","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAofA,WAASA,gBAAT,CAA0BC,IAA1B,EAAgCC,KAAhC,EAAuC;AACrC,SAAK,IAAIC,IAAIF,KAAKG,UAAL,CAAgBC,MAA7B,EAAqCF,IAAI,CAAzC,EAA4CA,GAA5C,EAAiD;AAC/C,UAAID,SAASD,KAAKG,UAAL,CAAgBD,IAAE,CAAlB,CAAb,EAAmC;AACjC,eAAOF,KAAKK,QAAL,CAAcH,CAAd,CAAP;AACD;AACF;AACD,WAAOI,EAAEC,KAAF,CAAQP,KAAKK,QAAb,CAAP;AACD;;;;AA3fOG,sB,kBAAAA,gB;;AACDF,O;;AACAG,O;;AACAC,S;;AACAC,Y;;AACAC,gB;;AAEKC,Q;;;;;;;;;;;;;;;;;;;;;AAINC,mB,GAAgB;AACpBC,mBAAW,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,EAAa,EAAb,EAAgB,EAAhB,EAAmB,EAAnB,EAAsB,EAAtB,EAAyB,EAAzB,EAA4B,EAA5B,EAA+B,EAA/B,EAAkC,EAAlC,EAAqC,EAArC,EAAwC,EAAxC,EAA2C,EAA3C,EAA8C,EAA9C,EAAiD,EAAjD,EAAoD,EAApD,EAAuD,EAAvD,EAA0D,EAA1D,EAA6D,EAA7D,EAAgE,EAAhE,EAAmE,EAAnE,EAAsE,EAAtE,EAAyE,EAAzE,EAA4E,EAA5E,EAA+E,EAA/E,EAAkF,EAAlF,EAAqF,EAArF,EAAwF,EAAxF,EAA2F,EAA3F,EAA8F,EAA9F,EAAiG,EAAjG,EAAoG,EAApG,EAAuG,EAAvG,EAA0G,EAA1G,EAA6G,EAA7G,EAAgH,EAAhH,EAAmH,EAAnH,EAAsH,EAAtH,CADS;AAEpBC,mBAAW,CACT,OADS,EACA,aADA,EACe,SADf,EAET,UAFS,EAEG,SAFH,EAEc,aAFd,EAGT,UAHS,EAGG,WAHH,EAGgB,WAHhB,EAIT,UAJS,EAIG,OAJH,EAIY,iBAJZ,EAKT,SALS,CAFS;AASpBC,qBAAaP,IAAIQ,cAAJ,EATO;AAUpBC,6BAAqB,CAAC,KAAD,EAAO,KAAP,EAAa,KAAb,EAAoB,SAApB,EAA+B,OAA/B,EAAwC,MAAxC,CAVD;AAWpBC,mBAAW,CACT,EAAEnB,OAAO,MAAT,EAAiBoB,IAAI,GAArB,EAA0BC,MAAM,KAAhC,EADS,CAXS;AAcpBC,sBAAc,CACZ,EAACC,MAAM,eAAP,EAAwBvB,OAAO,CAA/B,EADY,EAEZ,EAACuB,MAAM,eAAP,EAAwBvB,OAAO,CAA/B,EAFY,CAdM;AAkBpBwB,mBAAW,CACT,EAAEC,MAAM,MAAR,EAAgBC,IAAI,MAApB,EAA4BL,MAAM,KAAlC,EADS,CAlBS;AAqBpBM,qBAAa,CArBO;AAsBpBzB,oBAAY,EAtBQ;AAuBpB0B,gBAAQ,CAAC,wBAAD,EAA2B,0BAA3B,EAAuD,yBAAvD,CAvBY;AAwBpBC,kBAAU,CAxBU,EAwBP;AACbC,gBAAQ,MAzBY,EAyBJ;AAChBC,sBAAc,KA1BM,EA0BC;AACrBC,eAAO;AACLC,oBAAU,CADL;AAELC,oBAAU,GAFL;AAGLC,2BAAiB,CAHZ;AAILC,2BAAiB,EAJZ;AAKLC,sBAAY,EALP,EAKW;AAChBC,uBAAa,CANR,EAMW;AAChBC,uBAAa,GAPR;AAQLC,mBAAS,IARJ;AASLC,qBAAW,IATN;AAULC,uBAAa,IAVR;AAWLC,yBAAe,IAXV;AAYLC,yBAAe,IAZV;AAaLC,yBAAe,IAbV;AAcLC,2BAAiB,GAdZ;AAeLC,8BAAoB,GAff;AAgBLC,uBAAa,CAhBR;AAiBLC,wBAAc,CAjBT;AAkBLC,wBAAc,CAlBT;AAmBLC,8BAAoB,EAnBf;AAoBLC,yBAAe,EApBV;AAqBLC,yBAAe,EArBV;AAsBLC,wBAAc,GAtBT;AAuBLC,2BAAiB,EAvBZ;AAwBLC,0BAAgB,GAxBX;AAyBLC,wBAAe,SAzBV;AA0BLC,oBAAe,MA1BV;AA2BLC,oBAAe,MA3BV;AA4BLC,qBAAe,SA5BV;AA6BLC,yBAAe,MA7BV;AA8BLC,wBAAe,MA9BV;AA+BLC,sBAAe,SA/BV;AAgCLC,sBAAe,MAhCV;AAiCLC,oBAAU,WAjCL;AAkCLC,qBAAW,WAlCN;AAmCLC,gCAAsB,KAnCjB;AAoCLC,qCAA2B,KApCtB;AAqCLC,mCAAyB,KArCpB;AAsCLC,oCAA0B,IAtCrB;AAuCLC,mCAAyB,IAvCpB;AAwCLC,wCAA8B;AAxCzB;AA3Ba,O;;8DAuEhBC,gB;;;AAEJ,kCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,QAA/B,EAAyC;AAAA;;AAAA,0IACjCF,MADiC,EACzBC,SADyB;;AAEvC;AACAtE,YAAEwE,QAAF,CAAW,MAAKC,KAAhB,EAAuBjE,aAAvB;AACA,gBAAKiE,KAAL,CAAWC,UAAX,GAAwB,iBAAiB,MAAKD,KAAL,CAAWE,EAApD;AACA,gBAAKC,QAAL,GAAgBP,MAAhB;AACA,gBAAKQ,WAAL,GAAmBN,QAAnB;AACA,gBAAKO,WAAL,GAAmB,KAAnB;AACA,gBAAKC,cAAL,GAAsB,IAAtB;AACA,gBAAKC,GAAL,GAAW,IAAX;AACA,gBAAKC,UAAL,GAAkB,IAAlB;AACA,gBAAKC,WAAL,GAAmB,IAAnB;AACA,gBAAKC,WAAL,GAAmB,IAAnB;AACA,gBAAKzF,IAAL,GAAY;AACVC,mBAAO,CADG;AAEVyF,4BAAgB,CAFN;AAGVC,0BAAc;AAHJ,WAAZ;AAKA,gBAAKC,MAAL,GAAc,EAAd;AACA;AACA,gBAAKC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKG,QAAL,CAAcD,IAAd,OAAzB;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKI,cAAL,CAAoBF,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKK,WAAL,CAAiBH,IAAjB,OAA7B;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKI,cAAL,CAAoBF,IAApB,OAArC;AACA;AAzBuC;AA0BxC;;;;2CAEgB;AACf;AACA,gBAAII,SAASC,gBAAgBC,QAAhB,CAAyBF,MAAtC;AACA,gBAAIG,YAAYH,OAAO,KAAKI,QAAZ,CAAhB;AACA,gBAAIC,gBAAgBF,UAAUG,OAAV,GAAoB,GAAxC;AACA;AACA,gBAAIC,cAAcF,gBAAgB,8BAAlC;AACA,iBAAKG,YAAL,CAAkB,SAAlB,EAA6BD,WAA7B,EAA0C,CAA1C;AACA,gBAAIE,oBAAoBJ,gBAAgB,oCAAxC;AACA,iBAAKG,YAAL,CAAkB,gBAAlB,EAAoCC,iBAApC,EAAuD,CAAvD;AACA,gBAAIC,mBAAmBL,gBAAgB,mCAAvC;AACA,iBAAKG,YAAL,CAAkB,cAAlB,EAAkCE,gBAAlC,EAAoD,CAApD;AACA,gBAAIC,eAAeN,gBAAgB,+BAAnC;AACA,iBAAKG,YAAL,CAAkB,gBAAlB,EAAoCG,YAApC,EAAkD,CAAlD;AACD;;;uCAMYC,S,EAAW;AACtB,iBAAK3B,cAAL,GAAsB2B,SAAtB;AACD;;;0CAEe;AACd;AACA;AACA,gBAAIC,gBAAgB,KAAK5B,cAAL,CAAoB,CAApB,EAAuB6B,WAA3C;AACA,gBAAID,kBAAkB,CAAtB,EAAyB;AACvB;AACAA,8BAAgB,KAAKE,cAAL,EAAhB;AACAF,+BAAiB,EAAjB;AACA,kBAAIA,gBAAgB,GAApB,EAAyB;AACvBA,gCAAgB,GAAhB;AACD;AACD,qBAAOA,aAAP;AACA;AACA;AACA;AACD;AACD,gBAAIG,cAAcH,aAAlB;AACA,mBAAOG,WAAP;AACD;;;2CAEgB;AACf;AACA,gBAAIC,iBAAiB,KAAK1C,MAAL,CAAY2C,IAAZ,CAAiBvC,KAAjB,CAAuBwC,MAA5C;AACA;AACA,gBAAI,OAAOF,cAAP,KAA0B,WAA9B,EAA2C;AACzC;AACAA,+BAAiB,KAAKG,GAAL,CAASD,MAA1B;AACA;AACA,kBAAI,OAAOF,cAAP,KAA0B,WAA9B,EAA2C;AACzCA,iCAAiB,GAAjB;AACD;AACF,aAPD,MAQK;AACH;AACAA,+BAAiBA,eAAeI,OAAf,CAAuB,IAAvB,EAA4B,EAA5B,CAAjB;AACD;AACD,gBAAIC,eAAeC,SAASN,cAAT,CAAnB;AACA;AACA,gBAAIK,eAAe,GAAnB,EAAwB;AACtBA,6BAAe,GAAf;AACD;AACD,mBAAOA,YAAP;AACD;;;qCAEU;AACT,gBAAIjH,EAAE,MAAI,KAAKsE,KAAL,CAAWC,UAAjB,EAA6B5E,MAAjC,EAAyC;AACvC;AACAK,gBAAE,MAAI,KAAKsE,KAAL,CAAWC,UAAjB,EAA6B4C,MAA7B;AACD;AACF;;;qCACU;AACT;AACA,iBAAKC,SAAL,CAAe,KAAK7H,IAApB;AACA;AACA,iBAAK8H,QAAL;AACA;AACA,iBAAKvC,UAAL,GAAkB,KAAKwC,aAAL,EAAlB;AACA,iBAAKvC,WAAL,GAAmB,KAAK2B,cAAL,EAAnB;;AAEA,gBAAIa,SAAS,EAACC,KAAK,EAAN,EAAUC,OAAO,CAAjB,EAAoBC,QAAQ,EAA5B,EAAgCC,MAAM,CAAtC,EAAb;AACA,gBAAIC,QAAQ,KAAK9C,UAAjB;AACA,gBAAIgC,SAAS,KAAK/B,WAAlB;AACA;AACA,gBAAIF,MAAMzE,GAAGyH,MAAH,CAAU,KAAKjD,cAAL,CAAoB,CAApB,CAAV,EACPkD,MADO,CACA,KADA,EAEPC,IAFO,CAEF,OAFE,EAEOH,QAAQ,IAFf,EAGPG,IAHO,CAGF,QAHE,EAGSjB,SAAS,EAAV,GAAgB,IAHxB,EAIPiB,IAJO,CAIF,IAJE,EAII,KAAKzD,KAAL,CAAWC,UAJf,EAKPyD,OALO,CAKC,wBALD,EAK2B,IAL3B,EAMPF,MANO,CAMA,GANA,EAOPC,IAPO,CAOF,WAPE,EAOW,eAAeR,OAAOI,IAAtB,GAA6B,GAA7B,GAAmCJ,OAAOC,GAA1C,GAAgD,GAP3D,CAAV;;AASA;AACA,gBAAIS,iBAAiBC,WAAW,KAAK5D,KAAL,CAAW9C,KAAX,CAAiBM,WAA5B,CAArB;AACA;AACA,gBAAI,KAAKwC,KAAL,CAAW9C,KAAX,CAAiBM,WAAjB,KAAiC,CAArC,EAAwC;AACtCmG,+BAAiB,KAAKlD,WAAL,GAAmB,CAApC;AACA,kBAAI,KAAKD,UAAL,GAAkB,KAAKC,WAA3B,EAAwC;AACtCkD,iCAAiB,KAAKnD,UAAL,GAAkB,CAAnC;AACD;AACDmD,gCAAkB,EAAlB;AACD;AACD,gBAAIE,MAAM;AACRC,sBAAS,KAAK9D,KAAL,CAAW9C,KAAX,CAAiBC,QADlB;AAER4G,sBAAS,KAAK/D,KAAL,CAAW9C,KAAX,CAAiBE,QAFlB;AAGRC,+BAAiB,KAAK2C,KAAL,CAAW9C,KAAX,CAAiBG,eAH1B;AAIRC,+BAAiB,KAAK0C,KAAL,CAAW9C,KAAX,CAAiBI,eAJ1B;AAKRC,0BAAY,KAAKyC,KAAL,CAAWhD,MALf;AAMRQ,2BAAamG,cANL;AAORlG,2BAAa,KAAKuC,KAAL,CAAW9C,KAAX,CAAiBO,WAPtB;AAQRC,uBAAS,KAAKsC,KAAL,CAAW9C,KAAX,CAAiBQ,OARlB;AASRC,yBAAW,KAAKqC,KAAL,CAAW9C,KAAX,CAAiBS,SATpB;AAURC,2BAAa,KAAKoC,KAAL,CAAW9C,KAAX,CAAiBU,WAVtB;AAWRC,6BAAe,KAAKmC,KAAL,CAAW9C,KAAX,CAAiBW,aAXxB;AAYRC,6BAAe,KAAKkC,KAAL,CAAW9C,KAAX,CAAiBY,aAZxB;AAaRC,6BAAe,KAAKiC,KAAL,CAAW9C,KAAX,CAAiBa,aAbxB;AAcRC,+BAAiB,KAAKgC,KAAL,CAAW9C,KAAX,CAAiBc,eAd1B;AAeRC,kCAAoB,KAAK+B,KAAL,CAAW9C,KAAX,CAAiBe,kBAf7B;AAgBRC,2BAAa,KAAK8B,KAAL,CAAW9C,KAAX,CAAiBgB,WAhBtB;AAiBRC,4BAAc,KAAK6B,KAAL,CAAW9C,KAAX,CAAiBiB,YAjBvB;AAkBRC,4BAAc,KAAK4B,KAAL,CAAW9C,KAAX,CAAiBkB,YAlBvB;AAmBRC,kCAAoB,KAAK2B,KAAL,CAAW9C,KAAX,CAAiBmB,kBAnB7B;AAoBRC,6BAAe,KAAK0B,KAAL,CAAW9C,KAAX,CAAiBoB,aApBxB;AAqBRC,6BAAe,KAAKyB,KAAL,CAAW9C,KAAX,CAAiBqB,aArBxB;AAsBRC,4BAAc,KAAKwB,KAAL,CAAW9C,KAAX,CAAiBsB,YAtBvB;AAuBRC,+BAAiB,KAAKuB,KAAL,CAAW9C,KAAX,CAAiBuB,eAvB1B;AAwBRC,8BAAgB,KAAKsB,KAAL,CAAW9C,KAAX,CAAiBwB,cAxBzB;AAyBRC,4BAAe,KAAKqB,KAAL,CAAW9C,KAAX,CAAiByB,YAzBxB;AA0BRC,wBAAe,KAAKoB,KAAL,CAAW9C,KAAX,CAAiB0B,QA1BxB;AA2BRC,wBAAe,KAAKmB,KAAL,CAAW9C,KAAX,CAAiB2B,QA3BxB;AA4BRC,yBAAe,KAAKkB,KAAL,CAAW9C,KAAX,CAAiB4B,SA5BxB;AA6BRC,6BAAe,KAAKiB,KAAL,CAAW9C,KAAX,CAAiB6B,aA7BxB;AA8BRC,4BAAe,KAAKgB,KAAL,CAAW9C,KAAX,CAAiB8B,YA9BxB;AA+BRC,0BAAe,KAAKe,KAAL,CAAW9C,KAAX,CAAiB+B,UA/BxB;AAgCRC,0BAAe,KAAKc,KAAL,CAAW9C,KAAX,CAAiBgC,UAhCxB;AAiCR9D,0BAAe,KAAK4E,KAAL,CAAW5E,UAjClB;AAkCRkE,yCAA2B,KAAKU,KAAL,CAAW9C,KAAX,CAAiBoC,yBAlCpC;AAmCRD,oCAAsB,KAAKW,KAAL,CAAW9C,KAAX,CAAiBmC,oBAnC/B;AAoCRE,uCAAyB,KAAKS,KAAL,CAAW9C,KAAX,CAAiBqC,uBApClC;AAqCRC,wCAA0B,KAAKQ,KAAL,CAAW9C,KAAX,CAAiBsC,wBArCnC;AAsCRC,uCAAyB,KAAKO,KAAL,CAAW9C,KAAX,CAAiBuC,uBAtClC;AAuCRuE,+BAAiB,KAAKhE,KAAL,CAAWlD,MAvCpB;AAwCRmH,6BAAgB,KAAKC,YAAL,EAxCR;AAyCRC,yBAAY,KAAKC,eAAL,EAzCJ;AA0CRjF,wBAAU,KAAKa,KAAL,CAAW9C,KAAX,CAAiBiC,QA1CnB;AA2CRC,yBAAW,KAAKY,KAAL,CAAW9C,KAAX,CAAiBkC,SA3CpB;AA4CRM,4CAA8B,KAAKM,KAAL,CAAW9C,KAAX,CAAiBwC;AA5CvC,aAAV;AA8CA,iBAAKgB,WAAL,GAAmB,IAAI2D,SAAJ,CAAc9D,GAAd,EAAkBsD,GAAlB,CAAnB;AACA,iBAAKtD,GAAL,GAAWA,GAAX;AACD;;;yCAEc+D,G,EAAK;AAClB,gBAAIC,QAAQhJ,EAAEiJ,OAAF,CAAU,KAAKxE,KAAL,CAAW3D,SAArB,EAAgCiI,GAAhC,CAAZ;AACA,iBAAKtE,KAAL,CAAW3D,SAAX,CAAqBoI,MAArB,CAA4BF,KAA5B,EAAmC,CAAnC;AACA,iBAAKG,MAAL;AACD;;;wCAEa;AACZ,iBAAK1E,KAAL,CAAW3D,SAAX,CAAqBsI,IAArB,CAA0B,EAACzJ,OAAO,EAAR,EAAYoB,IAAI,GAAhB,EAAqBC,MAAM,EAA3B,EAA1B;AACD;;;yCAEcqI,Q,EAAU;AACvB,gBAAIL,QAAQhJ,EAAEiJ,OAAF,CAAU,KAAKxE,KAAL,CAAWtD,SAArB,EAAgCkI,QAAhC,CAAZ;AACA,iBAAK5E,KAAL,CAAWtD,SAAX,CAAqB+H,MAArB,CAA4BF,KAA5B,EAAmC,CAAnC;AACA,iBAAKG,MAAL;AACD;;;wCAEa;AACZ,iBAAK1E,KAAL,CAAWtD,SAAX,CAAqBiI,IAArB,CAA0B,EAAChI,MAAM,EAAP,EAAWC,IAAI,EAAf,EAAmBL,MAAM,EAAzB,EAA1B;AACD;;;uDAE4B;AAC3B;AACA,gBAAK,KAAKyD,KAAL,CAAW9C,KAAX,CAAiBG,eAAjB,KAAqC,IAAtC,IACC,KAAK2C,KAAL,CAAW9C,KAAX,CAAiBG,eAAjB,KAAqC,EADtC,IAECwH,MAAM,KAAK7E,KAAL,CAAW9C,KAAX,CAAiBG,eAAvB,CAFL,EAGG;AACD;AACA,mBAAK2C,KAAL,CAAW9C,KAAX,CAAiBG,eAAjB,GAAmC,CAAnC;AACA,mBAAK+C,WAAL,CAAiB0E,GAAjB,CAAqB,UAArB,EAAiC,yEAAjC,EAA4G,OAA5G,EAAqH,KAArH;AACD;AACD,gBAAK,KAAK9E,KAAL,CAAW9C,KAAX,CAAiBI,eAAjB,KAAqC,IAAtC,IACC,KAAK0C,KAAL,CAAW9C,KAAX,CAAiBI,eAAjB,KAAqC,EADtC,IAECuH,MAAM,KAAK7E,KAAL,CAAW9C,KAAX,CAAiBI,eAAvB,CAFL,EAGG;AACD;AACA,mBAAK0C,KAAL,CAAW9C,KAAX,CAAiBI,eAAjB,GAAmC,EAAnC;AACA,mBAAK8C,WAAL,CAAiB0E,GAAjB,CAAqB,UAArB,EAAiC,0EAAjC,EAA6G,OAA7G,EAAsH,KAAtH;AACD;AACD,gBAAK,KAAK9E,KAAL,CAAW9C,KAAX,CAAiBM,WAAjB,KAAiC,IAAlC,IACC,KAAKwC,KAAL,CAAW9C,KAAX,CAAiBM,WAAjB,KAAiC,EADlC,IAECqH,MAAM,KAAK7E,KAAL,CAAW9C,KAAX,CAAiBM,WAAvB,KACA,KAAKwC,KAAL,CAAW9C,KAAX,CAAiBM,WAAjB,GAA+B,CAHpC,EAIG;AACD;AACA,mBAAKwC,KAAL,CAAW9C,KAAX,CAAiBM,WAAjB,GAA+B,CAA/B;AACA,mBAAK4C,WAAL,CAAiB0E,GAAjB,CAAqB,UAArB,EAAiC,mEAAjC,EAAsG,OAAtG,EAA+G,KAA/G;AACD;AACD,iBAAKJ,MAAL;AACD;;;+BAEIK,K,EAAOC,I,EAAMC,K,EAAO1C,I,EAAM;AAC7B;AACAA,iBAAK2C,YAAL,CAAkBF,KAAKG,IAAL,CAAU,mBAAV,CAAlB;AACA;AACA,gBAAIC,cAAc1J,EAAE,MAAI,KAAKsE,KAAL,CAAWC,UAAjB,CAAlB;AACA;AACA,gBAAImF,YAAY/J,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B;AACA,mBAAKqJ,MAAL;AACD;AACF;;;8CAGmBxJ,K,EAAO;AACzB,gBAAIK,EAAE8J,QAAF,CAAW,KAAKrF,KAAL,CAAWjD,QAAtB,CAAJ,EAAqC;AACnC,qBAAO,EAACA,UAAU,KAAKiD,KAAL,CAAWjD,QAAtB,EAAgCuI,gBAAgB,IAAhD,EAAP;AACD;;AAED,gBAAIC,QAAQrK,QAAQ,CAApB;AACA,gBAAIsK,MAAM,CAACC,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASJ,KAAT,IAAkBE,KAAKG,IAAlC,CAAX;;AAEA,gBAAIC,OAAOJ,KAAKK,GAAL,CAAS,EAAT,EAAa,CAACN,GAAd,CAAX;AAAA,gBACIO,OAAOR,QAAQM,IADnB;AAAA,gBACyB;AACrBG,gBAFJ;;AAIA,gBAAID,OAAO,GAAX,EAAgB;AACdC,qBAAO,CAAP;AACD,aAFD,MAEO,IAAID,OAAO,CAAX,EAAc;AACnBC,qBAAO,CAAP;AACA;AACA,kBAAID,OAAO,IAAX,EAAiB;AACfC,uBAAO,GAAP;AACA,kBAAER,GAAF;AACD;AACF,aAPM,MAOA,IAAIO,OAAO,GAAX,EAAgB;AACrBC,qBAAO,CAAP;AACD,aAFM,MAEA;AACLA,qBAAO,EAAP;AACD;;AAEDA,oBAAQH,IAAR;;AAEA;AACA,gBAAIJ,KAAKC,KAAL,CAAWxK,KAAX,MAAsBA,KAA1B,EAAiC;AAAEsK,oBAAM,CAAN;AAAU;;AAE7C,gBAAIS,SAAS,EAAb;AACAA,mBAAOlJ,QAAP,GAAkB0I,KAAKS,GAAL,CAAS,CAAT,EAAYV,GAAZ,CAAlB;AACAS,mBAAOX,cAAP,GAAwBW,OAAOlJ,QAAP,GAAkB0I,KAAKC,KAAL,CAAWD,KAAKE,GAAL,CAASK,IAAT,IAAiBP,KAAKG,IAAjC,CAAlB,GAA2D,CAAnF;AACA,mBAAOK,MAAP;AACD;;;oCAEShL,I,EAAM;AACdA,iBAAKkL,SAAL,GAAiB,EAAjB;AACA,gBAAI,KAAKtF,MAAL,CAAYxF,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B,kBAAI+K,QAAQ,IAAIC,KAAJ,EAAZ;AACAD,oBAAME,OAAN,GAAgB,uBAAhB;AACAF,oBAAMnL,IAAN,GAAa,0BAA0B,KAAK4F,MAAL,CAAYxF,MAAtC,GACX,oEADW,GAC0DkL,KAAKC,SAAL,CAAe,KAAK3F,MAApB,CADvE;AAEA,oBAAMuF,KAAN;AACD;;AAED,gBAAI,KAAKvF,MAAL,IAAe,KAAKA,MAAL,CAAYxF,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,kBAAIoL,YAAYlL,EAAEmL,IAAF,CAAO,KAAK7F,MAAL,CAAY,CAAZ,EAAe8F,UAAtB,CAAhB;AACA,kBAAIC,YAAYrL,EAAEsL,OAAF,CAAUJ,SAAV,IAAuBA,UAAU,CAAV,CAAvB,GAAsC,IAAtD;;AAEA,kBAAI,KAAKzG,KAAL,CAAW/C,YAAX,KAA4B,MAAhC,EAAwC;AACtChC,qBAAKC,KAAL,GAAa,CAAb;AACAD,qBAAK2F,YAAL,GAAoB,CAApB;AACA3F,qBAAK0F,cAAL,GAAsB,KAAKE,MAAL,CAAY,CAAZ,EAAeiG,KAArC;AACD,eAJD,MAIO,IAAIvL,EAAEwL,QAAF,CAAWH,SAAX,CAAJ,EAA2B;AAChC3L,qBAAKC,KAAL,GAAa,CAAb;AACAD,qBAAK0F,cAAL,GAAsBpF,EAAEyL,MAAF,CAASJ,SAAT,CAAtB;AACA3L,qBAAK2F,YAAL,GAAoB,CAApB;AACD,eAJM,MAIA;AACL3F,qBAAKC,KAAL,GAAa,KAAK2F,MAAL,CAAY,CAAZ,EAAeoG,KAAf,CAAqB,KAAKjH,KAAL,CAAW/C,YAAhC,CAAb;AACAhC,qBAAKkL,SAAL,GAAiB,KAAKtF,MAAL,CAAY,CAAZ,EAAesF,SAAhC;AACA,oBAAIe,cAAc,KAAKC,mBAAL,CAAyBlM,KAAKC,KAA9B,CAAlB;AACA,oBAAIkM,aAAazL,IAAI0L,YAAJ,CAAiB,KAAKrH,KAAL,CAAWhD,MAA5B,CAAjB;AACA/B,qBAAK0F,cAAL,GAAsByG,WAAWnM,KAAKC,KAAhB,EAAuBgM,YAAYnK,QAAnC,EAA6CmK,YAAY5B,cAAzD,CAAtB;AACArK,qBAAK2F,YAAL,GAAoBjF,IAAI2L,UAAJ,CAAerM,KAAKC,KAApB,EAA2BgM,YAAYnK,QAAvC,CAApB;AACD;;AAED;AACA9B,mBAAKsM,UAAL,GAAkB;AAChBC,wBAAQ;AACNtM,yBAAO,KAAK2F,MAAL,CAAY,CAAZ,EAAe4G;AADhB;AADQ,eAAlB;AAKD;;AAED;AACA,gBAAI,KAAKzH,KAAL,CAAWnD,WAAX,KAA2B,CAA/B,EAAkC;AAChC,mBAAK,IAAI1B,IAAI,CAAb,EAAgBA,IAAI,KAAK6E,KAAL,CAAW3D,SAAX,CAAqBhB,MAAzC,EAAiDF,GAAjD,EAAsD;AACpD,oBAAImJ,MAAM,KAAKtE,KAAL,CAAW3D,SAAX,CAAqBlB,CAArB,CAAV;AACA;AACA,oBAAImJ,IAAIpJ,KAAJ,KAAc,MAAlB,EAA0B;AACxB,sBAAID,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,yBAAK0F,cAAL,GAAsB2D,IAAI/H,IAA1B;AACA;AACD;AACD;AACD;;AAED;AACA,oBAAIrB,QAAQ0I,WAAWU,IAAIpJ,KAAf,CAAZ;AACA,oBAAIA,UAAUD,KAAK2F,YAAnB,EAAiC;AAC/B3F,uBAAK0F,cAAL,GAAsB2D,IAAI/H,IAA1B;AACA;AACD;AACF;AACF,aAnBD,MAmBO,IAAI,KAAKyD,KAAL,CAAWnD,WAAX,KAA2B,CAA/B,EAAkC;AACvC,mBAAK,IAAI6K,IAAI,CAAb,EAAgBA,IAAI,KAAK1H,KAAL,CAAWtD,SAAX,CAAqBrB,MAAzC,EAAiDqM,GAAjD,EAAsD;AACpD,oBAAI9C,WAAW,KAAK5E,KAAL,CAAWtD,SAAX,CAAqBgL,CAArB,CAAf;AACA;AACA,oBAAI9C,SAASjI,IAAT,KAAkB,MAAlB,IAA4BiI,SAAShI,EAAT,KAAgB,MAAhD,EAAwD;AACtD,sBAAI3B,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,yBAAK0F,cAAL,GAAsBiE,SAASrI,IAA/B;AACA;AACD;AACD;AACD;;AAED;AACA,oBAAII,OAAOiH,WAAWgB,SAASjI,IAApB,CAAX;AACA,oBAAIC,KAAKgH,WAAWgB,SAAShI,EAApB,CAAT;AACA,oBAAIA,MAAM3B,KAAK2F,YAAX,IAA2BjE,QAAQ1B,KAAK2F,YAA5C,EAA0D;AACxD3F,uBAAK0F,cAAL,GAAsBiE,SAASrI,IAA/B;AACA;AACD;AACF;AACF;;AAED,gBAAItB,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,mBAAK0F,cAAL,GAAsB,UAAtB;AACD;AACF;;;yCAEc;AACb,mBAAO,KAAK1F,IAAL,CAAU0F,cAAjB;AACD;;;4CAEiB;AAChB,mBAAO,KAAK1F,IAAL,CAAU2F,YAAjB;AACD;;;wCAEa+G,O,EAAS;AACrB,iBAAK3H,KAAL,CAAWhD,MAAX,GAAoB2K,QAAQzM,KAA5B;AACA,iBAAKwJ,MAAL;AACD;;;sCAEWkD,G,EAAK;AACf,iBAAKzG,cAAL,CAAoB,EAApB;AACD;;;yCAEc0G,Q,EAAU;AACvB,iBAAKhH,MAAL,GAAcgH,SAASvD,GAAT,CAAa,KAAKwD,aAAL,CAAmB7G,IAAnB,CAAwB,IAAxB,CAAb,CAAd;AACA,gBAAIhG,OAAO,EAAX;AACA,iBAAK6H,SAAL,CAAe7H,IAAf;AACA,iBAAKA,IAAL,GAAYA,IAAZ;AACA;AACA;AACA;AACA,iBAAKyF,WAAL,CAAiBqH,WAAjB,CAA6B9M,KAAKC,KAAlC,EAAyCD,KAAK0F,cAA9C,EAA8D1F,KAAK2F,YAAnE;AACD;;;wCAEaoH,U,EAAY;AACxB,gBAAInH,SAAS,IAAIhF,UAAJ,CAAe;AAC1B8K,0BAAYqB,WAAWrB,UADG;AAE1BG,qBAAOkB,WAAWC;AAFQ,aAAf,CAAb;AAIApH,mBAAOsF,SAAP,GAAmBtF,OAAOqH,YAAP,CAAoB,KAAKlI,KAAL,CAAWmI,aAA/B,CAAnB;AACA,mBAAOtH,MAAP;AACD;;;6CAEkB;AACjB,gBAAIuH,MAAM,KAAKpI,KAAL,CAAWlD,MAAX,CAAkB,CAAlB,CAAV;AACA,iBAAKkD,KAAL,CAAWlD,MAAX,CAAkB,CAAlB,IAAuB,KAAKkD,KAAL,CAAWlD,MAAX,CAAkB,CAAlB,CAAvB;AACA,iBAAKkD,KAAL,CAAWlD,MAAX,CAAkB,CAAlB,IAAuBsL,GAAvB;AACA,iBAAK1D,MAAL;AACD;;;;QA/Z4BjJ,gB;;AA2a/BkE,uBAAiB0I,WAAjB,GAA+B,wBAA/B;;kCAEC1I,gB;;kCACAA,gB","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\nimport TimeSeries from 'app/core/time_series2';\n//import * as d3 from '../bower_components/d3/d3.js';\nimport * as d3 from './external/d3.v3.min';\nimport './css/panel.css!';\nimport './external/d3gauge';\n\nconst panelDefaults = {\n  fontSizes: [4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70],\n  fontTypes: [\n    'Arial', 'Avant Garde', 'Bookman',\n    'Consolas', 'Courier', 'Courier New',\n    'Garamond', 'Helvetica', 'Open Sans',\n    'Palatino', 'Times', 'Times New Roman',\n    'Verdana'\n  ],\n  unitFormats: kbn.getUnitFormats(),\n  operatorNameOptions: ['min','max','avg', 'current', 'total', 'name'],\n  valueMaps: [\n    { value: 'null', op: '=', text: 'N/A' }\n  ],\n  mappingTypes: [\n    {name: 'value to text', value: 1},\n    {name: 'range to text', value: 2},\n  ],\n  rangeMaps: [\n    { from: 'null', to: 'null', text: 'N/A' }\n  ],\n  mappingType: 1,\n  thresholds: '',\n  colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n  decimals: 2, // decimal precision\n  format: 'none', // unit format\n  operatorName: 'avg', // operator applied to time series\n  gauge: {\n    minValue: 0,\n    maxValue: 100,\n    tickSpaceMinVal: 1,\n    tickSpaceMajVal: 10,\n    gaugeUnits: '', // no units by default, this will be selected by user\n    gaugeRadius: 0, // 0 for auto-scale\n    pivotRadius: 0.1,\n    padding: 0.05,\n    edgeWidth: 0.05,\n    tickEdgeGap: 0.05,\n    tickLengthMaj: 0.15,\n    tickLengthMin: 0.05,\n    needleTickGap: 0.05,\n    needleLengthNeg: 0.2,\n    ticknessGaugeBasis: 200,\n    needleWidth: 5,\n    tickWidthMaj: 5,\n    tickWidthMin: 1,\n    unitsLabelFontSize: 22,\n    labelFontSize: 18,\n    zeroTickAngle: 60,\n    maxTickAngle: 300,\n    zeroNeedleAngle: 40,\n    maxNeedleAngle: 320,\n    outerEdgeCol:  '#0099CC',\n    innerCol:      '#fff',\n    pivotCol:      '#999',\n    needleCol:     '#0099CC',\n    unitsLabelCol: '#000',\n    tickLabelCol:  '#000',\n    tickColMaj:    '#0099CC',\n    tickColMin:    '#000',\n    tickFont: 'Open Sans',\n    unitsFont: 'Open Sans',\n    showThresholdOnGauge: false,\n    showThresholdColorOnValue: false,\n    showLowerThresholdRange: false,\n    showMiddleThresholdRange: true,\n    showUpperThresholdRange: true,\n    animateNeedleValueTransition: true,\n  },\n};\n\nclass D3GaugePanelCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, alertSrv) {\n    super($scope, $injector);\n    // merge existing settings with our defaults\n    _.defaults(this.panel, panelDefaults);\n    this.panel.gaugeDivId = 'd3gauge_svg_' + this.panel.id;\n    this.scoperef = $scope;\n    this.alertSrvRef = alertSrv;\n    this.initialized = false;\n    this.panelContainer = null;\n    this.svg = null;\n    this.panelWidth = null;\n    this.panelHeight = null;\n    this.gaugeObject = null;\n    this.data = {\n      value: 0,\n      valueFormatted: 0,\n      valueRounded: 0\n    };\n    this.series = [];\n    //console.log(\"D3GaugePanelCtrl constructor!\");\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    //console.log(\"D3GaugePanelCtrl constructor done!\");\n  }\n\n  onInitEditMode() {\n    // determine the path to this plugin\n    var panels = grafanaBootData.settings.panels;\n    var thisPanel = panels[this.pluginId];\n    var thisPanelPath = thisPanel.baseUrl + '/';\n    // add the relative path to the partial\n    var optionsPath = thisPanelPath + 'partials/editor.options.html';\n    this.addEditorTab('Options', optionsPath, 2);\n    var radialMetricsPath = thisPanelPath + 'partials/editor.radialmetrics.html';\n    this.addEditorTab('Radial Metrics', radialMetricsPath, 3);\n    var thresholdingPath = thisPanelPath + 'partials/editor.thresholding.html';\n    this.addEditorTab('Thresholding', thresholdingPath, 4);\n    var mappingsPath = thisPanelPath + 'partials/editor.mappings.html';\n    this.addEditorTab('Value Mappings', mappingsPath, 5);\n  }\n\n  /**\n   * [setContainer description]\n   * @param {[type]} container [description]\n   */\n  setContainer(container) {\n    this.panelContainer = container;\n  }\n\n  getPanelWidth() {\n    // with a full sized panel, this comes back as zero, so calculate from the div panel instead\n    //debugger;\n    var tmpPanelWidth = this.panelContainer[0].clientWidth;\n    if (tmpPanelWidth === 0) {\n      // just use the height...\n      tmpPanelWidth = this.getPanelHeight();\n      tmpPanelWidth -= 24;\n      if (tmpPanelWidth < 250) {\n        tmpPanelWidth = 250;\n      }\n      return tmpPanelWidth;\n      //var tmpPanelWidthCSS = $(\"div.panel\").css(\"width\");\n      //var tmpPanelWidthPx = tmpPanelWidthCSS.replace(\"px\",\"\");\n      //tmpPanelWidth = parseInt(tmpPanelWidthPx);\n    }\n    var actualWidth = tmpPanelWidth;\n    return actualWidth;\n  }\n\n  getPanelHeight() {\n    // panel can have a fixed height via options\n    var tmpPanelHeight = this.$scope.ctrl.panel.height;\n    // if that is blank, try to get it from our row\n    if (typeof tmpPanelHeight === 'undefined') {\n      // get from the row instead\n      tmpPanelHeight = this.row.height;\n      // default to 250px if that was undefined also\n      if (typeof tmpPanelHeight === 'undefined') {\n        tmpPanelHeight = 250;\n      }\n    }\n    else {\n      // convert to numeric value\n      tmpPanelHeight = tmpPanelHeight.replace(\"px\",\"\");\n    }\n    var actualHeight = parseInt(tmpPanelHeight);\n    // grafana minimum height for a panel is 250px\n    if (actualHeight < 250) {\n      actualHeight = 250;\n    }\n    return actualHeight;\n  }\n\n  clearSVG() {\n    if ($('#'+this.panel.gaugeDivId).length) {\n      //console.log(\"Clearing SVG\");\n      $('#'+this.panel.gaugeDivId).remove();\n    }\n  }\n  onRender() {\n    // update the values to be sent to the gauge constructor\n    this.setValues(this.data);\n    //console.log(\"Render D3\");\n    this.clearSVG();\n    // use jQuery to get the height on our container\n    this.panelWidth = this.getPanelWidth();\n    this.panelHeight = this.getPanelHeight();\n\n    var margin = {top: 10, right: 0, bottom: 30, left: 0};\n    var width = this.panelWidth;\n    var height = this.panelHeight;\n    //console.log(\"width: \" + width + \" height: \" + height);\n    var svg = d3.select(this.panelContainer[0])\n      .append(\"svg\")\n      .attr(\"width\", width + \"px\")\n      .attr(\"height\", (height + 24) + \"px\")\n      .attr(\"id\", this.panel.gaugeDivId)\n      .classed(\"svg-content-responsive\", true)\n      .append(\"g\")\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    // check which is smaller, the height or the width and set the radius to be half of the lesser\n    var tmpGaugeRadius = parseFloat(this.panel.gauge.gaugeRadius);\n    // autosize if radius is set to zero\n    if (this.panel.gauge.gaugeRadius === 0) {\n      tmpGaugeRadius = this.panelHeight / 2;\n      if (this.panelWidth < this.panelHeight) {\n        tmpGaugeRadius = this.panelWidth / 2;\n      }\n      tmpGaugeRadius -= 10;\n    }\n    var opt = {\n      minVal : this.panel.gauge.minValue,\n      maxVal : this.panel.gauge.maxValue,\n      tickSpaceMinVal: this.panel.gauge.tickSpaceMinVal,\n      tickSpaceMajVal: this.panel.gauge.tickSpaceMajVal,\n      gaugeUnits: this.panel.format,\n      gaugeRadius: tmpGaugeRadius,\n      pivotRadius: this.panel.gauge.pivotRadius,\n      padding: this.panel.gauge.padding,\n      edgeWidth: this.panel.gauge.edgeWidth,\n      tickEdgeGap: this.panel.gauge.tickEdgeGap,\n      tickLengthMaj: this.panel.gauge.tickLengthMaj,\n      tickLengthMin: this.panel.gauge.tickLengthMin,\n      needleTickGap: this.panel.gauge.needleTickGap,\n      needleLengthNeg: this.panel.gauge.needleLengthNeg,\n      ticknessGaugeBasis: this.panel.gauge.ticknessGaugeBasis,\n      needleWidth: this.panel.gauge.needleWidth,\n      tickWidthMaj: this.panel.gauge.tickWidthMaj,\n      tickWidthMin: this.panel.gauge.tickWidthMin,\n      unitsLabelFontSize: this.panel.gauge.unitsLabelFontSize,\n      labelFontSize: this.panel.gauge.labelFontSize,\n      zeroTickAngle: this.panel.gauge.zeroTickAngle,\n      maxTickAngle: this.panel.gauge.maxTickAngle,\n      zeroNeedleAngle: this.panel.gauge.zeroNeedleAngle,\n      maxNeedleAngle: this.panel.gauge.maxNeedleAngle,\n      outerEdgeCol:  this.panel.gauge.outerEdgeCol,\n      innerCol:      this.panel.gauge.innerCol,\n      pivotCol:      this.panel.gauge.pivotCol,\n      needleCol:     this.panel.gauge.needleCol,\n      unitsLabelCol: this.panel.gauge.unitsLabelCol,\n      tickLabelCol:  this.panel.gauge.tickLabelCol,\n      tickColMaj:    this.panel.gauge.tickColMaj,\n      tickColMin:    this.panel.gauge.tickColMin,\n      thresholds:    this.panel.thresholds,\n      showThresholdColorOnValue: this.panel.gauge.showThresholdColorOnValue,\n      showThresholdOnGauge: this.panel.gauge.showThresholdOnGauge,\n      showLowerThresholdRange: this.panel.gauge.showLowerThresholdRange,\n      showMiddleThresholdRange: this.panel.gauge.showMiddleThresholdRange,\n      showUpperThresholdRange: this.panel.gauge.showUpperThresholdRange,\n      thresholdColors: this.panel.colors,\n      needleValText : this.getValueText(),\n      needleVal : this.getValueRounded(),\n      tickFont: this.panel.gauge.tickFont,\n      unitsFont: this.panel.gauge.unitsFont,\n      animateNeedleValueTransition: this.panel.gauge.animateNeedleValueTransition\n    };\n    this.gaugeObject = new drawGauge(svg,opt);\n    this.svg = svg;\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  }\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  }\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  validateRadialMetricValues() {\n    // make sure the spacing values are valid\n    if ((this.panel.gauge.tickSpaceMinVal === null) ||\n        (this.panel.gauge.tickSpaceMinVal === \"\") ||\n        (isNaN(this.panel.gauge.tickSpaceMinVal))\n      ){\n      // alert about the error, and set it to 1\n      this.panel.gauge.tickSpaceMinVal = 1;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Tick Spacing Minor, auto-setting back to default of 1\", 'error', 10000);\n    }\n    if ((this.panel.gauge.tickSpaceMajVal === null) ||\n        (this.panel.gauge.tickSpaceMajVal === \"\") ||\n        (isNaN(this.panel.gauge.tickSpaceMajVal))\n      ){\n      // alert about the error, and set it to 10\n      this.panel.gauge.tickSpaceMajVal = 10;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Tick Spacing Major, auto-setting back to default of 10\", 'error', 10000);\n    }\n    if ((this.panel.gauge.gaugeRadius === null) ||\n        (this.panel.gauge.gaugeRadius === \"\") ||\n        (isNaN(this.panel.gauge.gaugeRadius) ||\n        (this.panel.gauge.gaugeRadius < 0))\n      ){\n      // alert about the error, and set it to 0\n      this.panel.gauge.gaugeRadius = 0;\n      this.alertSrvRef.set(\"Problem!\", \"Invalid Value for Gauge Radius, auto-setting back to default of 0\", 'error', 10000);\n    }\n    this.render();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    //console.log(\"d3gauge inside link\");\n    ctrl.setContainer(elem.find('.grafana-d3-gauge'));\n    // Check if there is a gauge rendered\n    var renderedSVG = $('#'+this.panel.gaugeDivId);\n    // console.log(\"link: found svg length \" + renderedSVG.length);\n    if (renderedSVG.length === 0) {\n      // no gauge found, force a render\n      this.render();\n    }\n  }\n\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return {decimals: this.panel.decimals, scaledDecimals: null};\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n        norm = delta / magn, // norm is between 1.0 and 10.0\n        size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n    return result;\n  }\n\n  setValues(data) {\n    data.flotpairs = [];\n    if (this.series.length > 1) {\n      var error = new Error();\n      error.message = 'Multiple Series Error';\n      error.data = 'Metric query returns ' + this.series.length +\n        ' series. Single Stat Panel expects a single series.\\n\\nResponse:\\n'+JSON.stringify(this.series);\n      throw error;\n    }\n\n    if (this.series && this.series.length > 0) {\n      var lastPoint = _.last(this.series[0].datapoints);\n      var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\n\n      if (this.panel.operatorName === 'name') {\n        data.value = 0;\n        data.valueRounded = 0;\n        data.valueFormatted = this.series[0].alias;\n      } else if (_.isString(lastValue)) {\n        data.value = 0;\n        data.valueFormatted = _.escape(lastValue);\n        data.valueRounded = 0;\n      } else {\n        data.value = this.series[0].stats[this.panel.operatorName];\n        data.flotpairs = this.series[0].flotpairs;\n        var decimalInfo = this.getDecimalsForValue(data.value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\n      }\n\n      // Add $__name variable for using in prefix or postfix\n      data.scopedVars = {\n        __name: {\n          value: this.series[0].label\n        }\n      };\n    }\n\n    // check value to text mappings if its enabled\n    if (this.panel.mappingType === 1) {\n      for (var i = 0; i < this.panel.valueMaps.length; i++) {\n        var map = this.panel.valueMaps[i];\n        // special null case\n        if (map.value === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = map.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to text mapping\n        var value = parseFloat(map.value);\n        if (value === data.valueRounded) {\n          data.valueFormatted = map.text;\n          return;\n        }\n      }\n    } else if (this.panel.mappingType === 2) {\n      for (var j = 0; j < this.panel.rangeMaps.length; j++) {\n        var rangeMap = this.panel.rangeMaps[j];\n        // special null case\n        if (rangeMap.from === 'null' && rangeMap.to === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = rangeMap.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to range mapping\n        var from = parseFloat(rangeMap.from);\n        var to = parseFloat(rangeMap.to);\n        if (to >= data.valueRounded && from <= data.valueRounded) {\n          data.valueFormatted = rangeMap.text;\n          return;\n        }\n      }\n    }\n\n    if (data.value === null || data.value === void 0) {\n      data.valueFormatted = \"no value\";\n    }\n  }\n\n  getValueText() {\n    return this.data.valueFormatted;\n  }\n\n  getValueRounded() {\n    return this.data.valueRounded;\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  onDataError(err) {\n    this.onDataReceived([]);\n  }\n\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    var data = {};\n    this.setValues(data);\n    this.data = data;\n    //console.log(\"Data value: \" + data.value + \" formatted: \" + data.valueFormatted + \" rounded: \" + data.valueRounded );\n    //var fmtTxt = kbn.valueFormats[this.panel.format];\n    //console.log(\"Format: \" + fmtTxt);\n    this.gaugeObject.updateGauge(data.value, data.valueFormatted, data.valueRounded);\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  invertColorOrder() {\n    var tmp = this.panel.colors[0];\n    this.panel.colors[0] = this.panel.colors[2];\n    this.panel.colors[2] = tmp;\n    this.render();\n  }\n}\n\nfunction getColorForValue(data, value) {\n  for (var i = data.thresholds.length; i > 0; i--) {\n    if (value >= data.thresholds[i-1]) {\n      return data.colorMap[i];\n    }\n  }\n  return _.first(data.colorMap);\n}\n\nD3GaugePanelCtrl.templateUrl = 'partials/template.html';\nexport {\n\tD3GaugePanelCtrl,\n\tD3GaugePanelCtrl as MetricsPanelCtrl\n};\n"]}