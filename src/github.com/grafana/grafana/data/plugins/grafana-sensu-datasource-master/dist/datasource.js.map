{"version":3,"sources":["../src/datasource.js"],"names":["angular","_","dateMath","kbn","SensuDatasource","instanceSettings","$q","backendSrv","templateSrv","type","url","name","basicAuth","withCredentials","q","options","datasourceRequest","data","method","headers","then","mapToClientNameAndVersion","result","map","d","i","text","value","version","dimensions","clients","length","dimensionType","aClientName","push","checks","aCheck","aggregates","anAggregate","target","uris","dimensionURI","clientNames","getClientNames","checkNames","getCheckNames","aggregateNames","getAggregateNames","aCheckName","anAggregateName","sourceType","j","aggregateMode","aTarget","response","convertEventsToDataPoints","convertResultsToJSON","convertResultsToTable","convertAggregatesToDataPoints","convertClientHistoryToDataPoints","console","log","undefined","singleData","anEvent","datapoints","startingTimestamp","timestamp","check","history","last_execution","y","issued","status","rowData","rowInfo","aRow","client","executed","output","thresholds","warning","critical","columns","rows","message","newData","checkType","convertEventDataToAggregateList","convertEventDataToAggregateClient","convertEventDataToAggregateChecks","Math","floor","Date","now","dataSet","clientName","checkData","checkName","clientData","item","results","ok","stale","total","unknown","dimension","mapToTextValue","queries","_this","singleTarget","targets","forEach","hide","fullQuery","join","interval","interval_to_ms","minimumInterval","secondsToHms","deferred","defer","singleDataQuery","resolve","error","Error","reject","promise","allQueries","all","first","multipleDataQueries","uriType","params","httpOptions","anError","parseQueryResult","pendingQueries","dataCalls","uriList","getQueryURIByType","errors","updates","update","title"],"mappings":"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","file":"datasource.js","sourcesContent":["import angular from \"angular\";\nimport _ from \"lodash\";\nimport dateMath from \"app/core/utils/datemath\";\nimport kbn from \"app/core/utils/kbn\";\n\nexport class SensuDatasource {\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv) {\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n  }\n\n  // Required for templating\n  // gets the clients from Sensu API\n  // https://sensuapp.org/docs/0.26/api/clients-api.html\n\n  /**\n   * [metricFindQuery description]\n   * @param  {[type]} options [description]\n   * @return {[type]}         [description]\n   */\n  metricFindQuery(options) {\n    //console.log(\"metricFindQuery entered\");\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/clients',\n      data: options,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    }).then(this.mapToClientNameAndVersion);\n  }\n\n  /**\n   * [mapToClientNameAndVersion description]\n   * @param  {[type]} result [description]\n   * @return {[type]}        [description]\n   */\n  mapToClientNameAndVersion(result) {\n    return _.map(result.data, (d, i) => {\n      return {\n        text: d.name,\n        value: d.version\n      };\n    });\n  }\n\n  /**\n   * [getClientNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getClientNames(dimensions) {\n    var clients = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'clientName') {\n        var aClientName = dimensions[i].value;\n        clients.push(aClientName);\n      }\n    }\n    return clients;\n  }\n\n  /**\n   * [getCheckNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getCheckNames(dimensions) {\n    var checks = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'checkName') {\n        var aCheck = dimensions[i].value;\n        checks.push(aCheck);\n      }\n    }\n    return checks;\n  }\n\n  /**\n   * [getAggregateNames description]\n   * @param  {[type]} dimensions [description]\n   * @return {[type]}            [description]\n   */\n  getAggregateNames(dimensions) {\n    var aggregates = [];\n    for (var i = 0; i < dimensions.length; i++) {\n      if (dimensions[i].dimensionType === 'aggregateName') {\n        var anAggregate = dimensions[i].value;\n        aggregates.push(anAggregate);\n      }\n    }\n    return aggregates;\n  }\n\n  /**\n   * [getQueryURIByType description]\n   * @param  {[type]} target [description]\n   * @return {[type]}        [Array of URIs]\n   */\n  getQueryURIByType(target) {\n    var uris = [];\n    var dimensionURI = '/events';\n    var clientNames = this.getClientNames(target.dimensions);\n    var checkNames = this.getCheckNames(target.dimensions);\n    var aggregateNames = this.getAggregateNames(target.dimensions);\n\n    var aClientName = null;\n    var aCheckName = null;\n    var anAggregateName = null;\n    switch (target.sourceType) {\n      case 'events':\n        // https://sensuapp.org/docs/0.26/api/events-api.html\n        dimensionURI = '/events';\n        aClientName = null;\n        aCheckName = null;\n        if (clientNames.length) {\n          for (let i = 0; i < clientNames.length; i++) {\n            aClientName = clientNames[i];\n            dimensionURI = '/events/' + aClientName;\n            uris.push(dimensionURI);\n          }\n        }\n        if ((checkNames.length) && (clientNames.length)) {\n          for (let i = 0; i < clientNames.length; i++) {\n            aClientName = clientNames[i];\n            for (let j = 0; j < checkNames.length; j++) {\n              aCheckName = checkNames[i];\n              dimensionURI = '/events/' + aClientName + '/' + aCheckName;\n              uris.push(dimensionURI);\n            }\n          }\n        }\n        if (uris.length === 0) {\n          uris.push(dimensionURI);\n        }\n        break;\n      case 'results_json':\n      case 'results_table':\n        // https://sensuapp.org/docs/0.26/api/results-api.html\n        dimensionURI = '/results';\n        if (clientNames.length) {\n          for (let i = 0; i < clientNames.length; i++) {\n            aClientName = clientNames[i];\n            dimensionURI = '/results/' + aClientName;\n            uris.push(dimensionURI);\n          }\n        }\n        if ((checkNames.length) && (clientNames.length)) {\n          for (let i = 0; i < clientNames.length; i++) {\n            aClientName = clientNames[i];\n            for (let j = 0; j < checkNames.length; j++) {\n              aCheckName = checkNames[i];\n              dimensionURI = '/results/' + aClientName + '/' + aCheckName;\n              uris.push(dimensionURI);\n            }\n          }\n        }\n        if (uris.length === 0) {\n          uris.push(dimensionURI);\n        }\n        break;\n      case 'aggregates':\n        // https://sensuapp.org/docs/0.26/api/aggregates-api.html\n        dimensionURI = '/aggregates';\n        // name, name/clients, name/checks, name/results/severity\n        if (aggregateNames.length) {\n          for (let i = 0; i < aggregateNames.length; i++) {\n            anAggregateName = aggregateNames[i];\n            dimensionURI = '/aggregates/' + anAggregateName;\n            switch(target.aggregateMode) {\n              case 'clients':\n                dimensionURI = '/aggregates/' + anAggregateName + '/clients';\n                break;\n              case 'checks':\n                dimensionURI = '/aggregates/' + anAggregateName + '/checks';\n                break;\n              case 'list':\n                dimensionURI = '/aggregates/' + anAggregateName;\n                break;\n            }\n            uris.push(dimensionURI);\n          }\n        }\n        if (uris.length === 0) {\n          uris.push(dimensionURI);\n        }\n        break;\n      case 'clienthistory':\n        // look for clientName in dimensions\n        dimensionURI = '/clients';\n        if (clientNames.length) {\n          for (let i = 0; i < clientNames.length; i++) {\n            aClientName = clientNames[i];\n            dimensionURI = '/clients/' + aClientName + '/history';\n            uris.push(dimensionURI);\n          }\n        }\n        if (uris.length === 0) {\n          uris.push(dimensionURI);\n        }\n        break;\n    }\n\n    return uris;\n  }\n\n  /**\n   * [parseQueryResult description]\n   * @param  {[type]} aTarget  [description]\n   * @param  {[type]} response [description]\n   * @return {[type]}          [description]\n   */\n  parseQueryResult(aTarget,response) {\n    var result = [];\n    if (!response || !response.data) {\n      return result;\n    }\n    switch (aTarget.sourceType) {\n      case 'events':\n        result = this.convertEventsToDataPoints(response);\n        break;\n      case 'results_json':\n        result = this.convertResultsToJSON(response);\n        break;\n      case 'results_table':\n        result = this.convertResultsToTable(response);\n        break;\n      case 'aggregates':\n        result = this.convertAggregatesToDataPoints(response);\n        break;\n      case 'clienthistory':\n        result = this.convertClientHistoryToDataPoints(response);\n        break;\n      default:\n        console.log(\"Unknown source type\");\n        break;\n    }\n    return result;\n  }\n\n  /**\n   * [convertEventsToDataPoints description]\n   * @param  {[type]} response [description]\n   * @return {[type]}        [description]\n   */\n  convertEventsToDataPoints(response) {\n    // convert history to datapoints\n\n    // the result has no \"datapoints\", need to create it based on the check data\n\n    // when we have a checkname and an clientName, the response is different, the\n    // data is not an array, but contains the same information, recreate and push\n    if (response.data.length === undefined) {\n      var singleData = response.data;\n      response.data = [];\n      response.data.push(singleData);\n    }\n    for (var i = 0; i < response.data.length; i++) {\n      var anEvent = response.data[i];\n      var datapoints = [];\n      var startingTimestamp = 0;\n      // an event with client param has a timestamp at the toplevel\n      if (anEvent.timestamp !== undefined) {\n        startingTimestamp = anEvent.timestamp - (60 * anEvent.check.history.length);\n      }\n      if (anEvent.last_execution !== undefined) {\n        startingTimestamp = anEvent.last_execution - (60 * anEvent.history.length);\n      }\n      // time needs to be in MS, we get EPOCH from Sensu\n      for (var y = 0; y < anEvent.check.history.length; y++) {\n        datapoints[y] = [anEvent.check.history[y], (startingTimestamp + (60 * y)) * 1000];\n      }\n      anEvent.datapoints = datapoints;\n      // set the target to be the check name\n      if (anEvent.check.name !== undefined) {\n        anEvent.target = anEvent.check.name;\n      } else {\n        anEvent.target = anEvent.check;\n      }\n    }\n    return response;\n  }\n\n  /**\n   * [convertResultsToDataPoints description]\n   * @param  {[type]} response [description]\n   * @return {[type]}        [description]\n   */\n  convertResultsToDataPoints(response) {\n    // the result has no \"datapoints\", need to create it based on the check data\n    // when we have a checkname and an clientName, the response is different, the\n    // data is not an array, but contains the same information, recreate and push\n    if (response.data.length === undefined) {\n      var singleData = response.data;\n      response.data = [];\n      response.data.push(singleData);\n    }\n    for (var i = 0; i < response.data.length; i++) {\n      var anEvent = response.data[i];\n      //var str = JSON.stringify(anEvent, null, 2);\n      //console.log(str);\n      var datapoints = [];\n      if (anEvent.check.issued !== undefined) {\n        datapoints[0] = [anEvent.check.status, (anEvent.check.issued * 1000)];\n        // the duration is here...\n        // datapoints[0] = [anEvent.check.duration, (anEvent.check.issued * 1000)];\n      }\n      anEvent.datapoints = datapoints;\n      // set the target to be the check name\n      if (anEvent.check.name !== undefined) {\n        anEvent.target = anEvent.check.name;\n      } else {\n        anEvent.target = anEvent.check;\n      }\n    }\n    return response;\n  }\n\n  convertResultsToTable(response) {\n    // the result has no \"datapoints\", need to create it based on the check data\n    // when we have a checkname and a clientName, the response is different, the\n    // data is not an array, but contains the same information, recreate and push\n    if (response.data.length === undefined) {\n      var singleData = response.data;\n      response.data = [];\n      response.data.push(singleData);\n    }\n    // this will be collapsed into table format, where the columns are predefined\n    // and each row is a response formatted to the columns\n    var rowData = [];\n    for (var i = 0; i < response.data.length; i++) {\n      var rowInfo = response.data[i];\n      var aRow = [\n        rowInfo.check.issued * 1000,\n        rowInfo.client,\n        rowInfo.check.name,\n        rowInfo.check.status,\n        rowInfo.check.issued * 1000,\n        rowInfo.check.executed * 1000,\n        rowInfo.check.output,\n        rowInfo.check.type,\n        rowInfo.check.thresholds.warning,\n        rowInfo.check.thresholds.critical\n      ];\n      // now push into rowData\n      rowData.push(aRow);\n    }\n    // collapse everything into data[0]\n    var anEvent = response.data[0];\n    var datapoints = [];\n    datapoints[0] = [anEvent.check.status, (anEvent.check.issued * 1000)];\n    anEvent.datapoints = datapoints;\n    anEvent.type = \"table\";\n    anEvent.columns = [\n      { text: 'Time', type: 'date'},\n      { text: 'client' },\n      { text: 'check.name' },\n      { text: 'check.status' },\n      { text: 'check.issued', type: 'date' },\n      { text: 'check.executed', type: 'date' },\n      { text: 'check.output' },\n      { text: 'check.type' },\n      { text: 'check.thresholds.warning' },\n      { text: 'check.thresholds.critical' }\n    ];\n    anEvent.rows = rowData;\n    // truncate the rest\n    response.data = [anEvent];\n    //var str = JSON.stringify(response, null, 2);\n    //console.log(str);\n    return response;\n  }\n\n  /*\nResponse come back as:\n{\n  \"client\": \"p3-graphite-t1\",\n  \"check\": {\n    \"thresholds\": {\n      \"warning\": 120,\n      \"critical\": 180\n    },\n    \"name\": \"keepalive\",\n    \"issued\": 1482067284,\n    \"executed\": 1482067284,\n    \"output\": \"Keepalive sent from client 3 seconds ago\",\n    \"status\": 0,\n    \"type\": \"standard\"\n  }\n}\n   */\n  convertResultsToJSON(response) {\n    for (var i = 0; i < response.data.length; i++) {\n      var anEvent = response.data[i];\n      var datapoints = [];\n      if (anEvent.check.issued !== undefined) {\n        var data = {\n          timestamp: (anEvent.check.issued * 1000),\n          message: anEvent.check.name,\n          client: anEvent.client,\n          check: {\n            name: anEvent.check.name,\n            issued: (anEvent.check.issued * 1000),\n            executed: (anEvent.check.executed * 1000),\n            output: anEvent.check.output,\n            status: anEvent.check.status,\n            type: anEvent.check.type\n          }\n        }\n        datapoints.push(data);\n        anEvent.datapoints = datapoints;\n        delete anEvent.check;\n        delete anEvent.client;\n        anEvent.type = 'docs';\n      }\n    }\n    //var str = JSON.stringify(response, null, 2);\n    //console.log(str);\n    return response;\n  }\n\n  /**\n   * [convertAggregatesToDataPoints description]\n   * @param  {[type]} response [description]\n   * @return {[type]}        [description]\n   */\n  convertAggregatesToDataPoints(response) {\n    // convert history to datapoints\n\n    // the result has no \"datapoints\", need to create it based on the check data\n\n    // when we have a checkname and an clientName, the response is different, the\n    // data is not an array, but contains the same information, recreate and push\n    if (response.data.length === undefined) {\n      var singleData = response.data;\n      response.data = [];\n      response.data.push(singleData);\n    }\n    // storage for new data series constructed by aggregate responses\n    var newData = null;\n    for (var i = 0; i < response.data.length; i++) {\n      var anEvent = response.data[i];\n      if (anEvent.checks !== undefined) {\n        // create a new block of datapoints for each aggregate result json entry\n        //\n        var checkType = typeof(anEvent.checks);\n        switch (checkType) {\n          case 'number':\n            // checks is a number, this is an aggregate list response\n            newData = this.convertEventDataToAggregateList(anEvent, newData);\n            break;\n          case 'object':\n            // check is an object, which is an aggregate clients response\n            newData = this.convertEventDataToAggregateClient(anEvent, newData);\n            break;\n        }\n        continue;\n      }\n      if (anEvent.clients !== undefined) {\n        newData = this.convertEventDataToAggregateChecks(anEvent, newData);\n        continue;\n      }\n\n      // this is a simple aggregate response (no mode)\n      var datapoints = [];\n      // timestamp is the query now (just use now)\n      var timestamp = Math.floor( Date.now() );\n      datapoints[0] = [0, timestamp];\n      anEvent.datapoints = datapoints;\n      // set the target to be the name of the aggregate\n      anEvent.target = anEvent.name;\n    }\n    if (newData !== null) {\n      // overwrite the old data field with the new expanded set\n      response.data = newData;\n    }\n    return response;\n  }\n\n  // An aggregate checks result has the format\n  // {\n  //    clients: [\n  //      clientName\n  //    ],\n  //    name: checkName\n  // }\n  convertEventDataToAggregateChecks(anEvent, dataSet) {\n    var timestamp = Math.floor( Date.now() );\n    if (dataSet === null) {\n      // initialize empty array\n      dataSet = [];\n    }\n    // iterate over the checks\n    for (var i = 0; i < anEvent.clients.length; i++) {\n      var clientName = anEvent.clients[i];\n      var checkData = {\n        target: anEvent.name,\n        datapoints: [\n          [clientName, timestamp]\n        ]\n      };\n      dataSet.push(checkData);\n    }\n    return dataSet;\n  }\n\n  // An aggregate clients result has the format\n  // {\n  //    checks: [\n  //      checkName\n  //    ],\n  //    name: clientName\n  // }\n  convertEventDataToAggregateClient(anEvent, dataSet) {\n    var timestamp = Math.floor( Date.now() );\n    if (dataSet === null) {\n      // initialize empty array\n      dataSet = [];\n    }\n    // iterate over the checks\n    for (var i = 0; i < anEvent.checks.length; i++) {\n      var checkName = anEvent.checks[i];\n      var clientData = {\n        target: anEvent.name,\n        datapoints: [\n          [checkName, timestamp]\n        ]\n      };\n      dataSet.push(clientData);\n    }\n    return dataSet;\n  }\n\n  // An aggregate list result has the format\n  // {\n  //   checks: int,\n  //   clients: int,\n  //   results: {\n  //    critical: int,\n  //    ok: int,\n  //    stale: int,\n  //    total: int,\n  //    unknown: int,\n  //    warning: int\n  //   }\n  // }\n  convertEventDataToAggregateList(anEvent, dataSet) {\n    if (dataSet === null) {\n      // initialize empty array\n      dataSet = [];\n    }\n    var timestamp = Math.floor( Date.now() );\n    var item = {\n      target: 'checks',\n      datapoints: [\n        [anEvent.checks, timestamp]\n      ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'clients',\n      datapoints: [ [anEvent.clients, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'critical',\n      datapoints: [ [anEvent.results.critical, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'ok',\n      datapoints: [ [anEvent.results.ok, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'stale',\n      datapoints: [ [anEvent.results.stale, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'total',\n      datapoints: [ [anEvent.results.total, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'unknown',\n      datapoints: [ [anEvent.results.unknown, timestamp] ]\n    };\n    dataSet.push(item);\n    item = {\n      target: 'warning',\n      datapoints: [ [anEvent.results.warning, timestamp] ]\n    };\n    dataSet.push(item);\n\n    return dataSet;\n  }\n  /**\n   * [convertClientHistoryToDataPoints description]\n   * @param  {[type]} response [description]\n   * @return {[type]}        [description]\n   */\n  convertClientHistoryToDataPoints(response) {\n    // the result has no \"datapoints\", need to create it based on the check data\n    // when we have a checkname and an clientName, the response is different, the\n    // data is not an array, but contains the same information, recreate and push\n    //if (response.data.length === undefined) {\n    //  var singleData = response.data;\n    //  response.data = [];\n    //  response.data.push(singleData);\n    //}\n    for (var i = 0; i < response.data.length; i++) {\n      var anEvent = response.data[i];\n      var datapoints = [];\n      var startingTimestamp = 0;\n      if (anEvent.last_execution !== undefined) {\n        startingTimestamp = anEvent.last_execution - (60 * anEvent.history.length);\n      }\n      // time needs to be in MS, we get EPOCH from Sensu\n      if (anEvent.history !== undefined) {\n        for (var y = 0; y < anEvent.history.length; y++) {\n          datapoints[y] = [anEvent.history[y], (startingTimestamp + (60 * y)) * 1000];\n        }\n      }\n      anEvent.datapoints = datapoints;\n      // set the target to be the check name\n      anEvent.target = 'unknown';\n      if (anEvent.name !== undefined) {\n        anEvent.target = anEvent.name;\n      }\n      if (anEvent.check !== undefined) {\n        anEvent.target = anEvent.check;\n      }\n    }\n    return response;\n  }\n\n  /**\n   *\n   */\n  getCheckInterval(client, checkName) {\n      // http://10.227.86.62/results/default-oel-67-x86-64/keepalive\n      /* The check may not have interval defined, which means it is defaulted to 60 seconds\n      {\n        \"client\": \"default-oel-67-x86-64\",\n        \"check\": {\n          \"thresholds\": {\n            \"warning\": 120,\n            \"critical\": 180\n          },\n          \"name\": \"keepalive\",\n          \"issued\": 1476277039,\n          \"executed\": 1476277039,\n          \"output\": \"No keepalive sent from client for 40860 seconds (>=180)\",\n          \"status\": 2,\n          \"type\": \"standard\"\n        }\n      }\n       */\n    }\n\n  /**\n   * [dimensionFindValues description]\n   * @param  {[type]} target    [description]\n   * @param  {[type]} dimension [description]\n   * @return {[type]}           [description]\n   */\n  dimensionFindValues(target, dimension) {\n    var dimensionURI = '/clients';\n\n    switch (dimension.dimensionType) {\n      case 'clientName':\n        dimensionURI = '/clients';\n        break;\n      case 'checkName':\n        dimensionURI = '/checks';\n        break;\n      case 'aggregateName':\n        dimensionURI = '/aggregates';\n        break;\n    }\n    return this.backendSrv.datasourceRequest({\n      url: this.url + dimensionURI,\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    }).then(this.mapToTextValue);\n  }\n\n  mapToTextValue(result) {\n    return _.map(result.data, (d, i) => {\n      return {\n        text: d.name,\n        value: d.name\n      };\n    });\n  }\n\n  queryWorks(options) {\n    //console.log(\"query entered\");\n    var queries = [];\n    var _this = this;\n    var singleTarget = null;\n    options.targets.forEach(function(target) {\n      singleTarget = target;\n      if (target.hide || !target.target) {\n        return;\n      }\n    });\n    var fullQuery = queries.join(',');\n    var interval = options.interval;\n    //console.log(\"options interval = \" + interval);\n    if (kbn.interval_to_ms(interval) < this.minimumInterval) {\n      // console.log(\"Detected interval smaller than allowed: \" + interval);\n      interval = kbn.secondsToHms(this.minimumInterval / 1000);\n      // console.log(\"New Interval: \" + interval);\n    }\n    //console.log(\"interval after min check = \" + interval);\n    var deferred = this.q.defer();\n    var response = this.singleDataQuery(singleTarget);\n    if (response !== null) {\n      deferred.resolve(response);\n    } else {\n      console.error('Unable to load data.');\n      var error = new Error(\"Unable to load data\");\n      deferred.reject(error);\n    }\n    return deferred.promise;\n  }\n\n  query(options) {\n    //console.log(\"query entered\");\n    var queries = [];\n    var _this = this;\n    var singleTarget = null;\n    options.targets.forEach(function(target) {\n      // TODO handle hide and no target specified\n      //if (target.hide || !target.target) {\n      //  continue;\n      //}\n      queries.push(target);\n    });\n    var interval = options.interval;\n    //console.log(\"options interval = \" + interval);\n    if (kbn.interval_to_ms(interval) < this.minimumInterval) {\n      // console.log(\"Detected interval smaller than allowed: \" + interval);\n      interval = kbn.secondsToHms(this.minimumInterval / 1000);\n      // console.log(\"New Interval: \" + interval);\n    }\n    //console.log(\"interval after min check = \" + interval);\n    var deferred = this.q.defer();\n\n    // if there are no queries, return empty data\n    if (queries.length === 0) {\n      // console.log(\"no tags visible or specified, no data to fetch\");\n      deferred.resolve({\n        data: []\n      });\n      return deferred.promise;\n    }\n    var allQueries = this.q.all({\n        first: _this.multipleDataQueries(queries),\n    });\n    allQueries.then(function(results) {\n      // return results from queries\n      deferred.resolve(results.first);\n    });\n    return deferred.promise;\n  }\n\n  singleDataQuery(singleTarget, uriType) {\n    //console.log(\"singleDataQuery entered\");\n    var _this = this;\n    var deferred = this.q.defer();\n    var params = {};\n    var httpOptions = {\n      method: 'GET',\n      url: this.url + uriType,\n      params: params,\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      }\n    };\n    this.backendSrv.datasourceRequest(httpOptions)\n      .then(function(response) {\n        var anError = null;\n        if (response.status !== 200) {\n          console.log(\"error...\");\n          anError = new Error(\"Bad Status: \" + response.status);\n          deferred.reject(anError);\n        }\n        if (!response.data) {\n          anError = new Error(\"No data\");\n          deferred.reject(anError);\n        }\n        deferred.resolve(_this.parseQueryResult(singleTarget,response));\n      }, function(response) {\n        console.error('Unable to load data. Response: %o', response.data ? response.data.message : response);\n        var error = new Error(\"Unable to load data\");\n        deferred.reject(error);\n      });\n\n    return deferred.promise;\n  }\n\n  multipleDataQueries(pendingQueries) {\n    var deferred = this.q.defer();\n    var dataCalls = [];\n    var _this = this;\n    // for each query, we get a list of sensu uris' to hit\n    // to retrieve the data\n    angular.forEach(pendingQueries, function(aTarget) {\n      var uriList = _this.getQueryURIByType(aTarget);\n      for (var i = 0; i < uriList.length; i++) {\n        dataCalls.push(_this.singleDataQuery(aTarget, uriList[i]));\n      }\n    });\n    this.q.all(dataCalls)\n      .then(\n        function(results) {\n          var response = {\n            data: []\n          };\n          // merge all of the results into one response\n          angular.forEach(results, function(result) {\n            angular.forEach(result.data, function(dataSet) {\n              response.data.push(dataSet);\n            });\n          });\n          deferred.resolve(response);\n        },\n        function(errors) {\n          deferred.reject(errors);\n        },\n        function(updates) {\n          deferred.update(updates);\n        }\n     );\n   return deferred.promise;\n }\n\n  // Required\n  // Used for testing datasource in datasource configuration pange\n  //    'Access-Control-Allow-Origin': \"http://localhost:3000\"\n  //\n\n  /**\n   * [testDatasource description]\n   * @return {[type]} [description]\n   */\n  testDatasource() {\n    return this.backendSrv.datasourceRequest({\n      url: this.url + '/info',\n      headers: {\n        'Content-Type': 'application/json',\n        \"Authorization\": this.basicAuth\n      },\n      method: 'GET',\n    }).then(response => {\n      if (response.status === 200) {\n        return {\n          status: \"success\",\n          message: \"Data source is working\",\n          title: \"Success\"\n        };\n      }\n    });\n  }\n}\n"]}