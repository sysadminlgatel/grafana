{"version":3,"sources":["../src/splunk_api.js"],"names":["splunkAPIFactory","$httpParamSerializerJQLike","backendSrv","SplunkAPI","instanceSettings","options","jsonData","url","basicAuth","withCredentials","paramSerializer","AUTO_CANCEL","_","isNumber","autoCancel","STATUS_BUCKETS","statusBuckets","DEFAULT_EARLIEST_TIME","defaultEarliestTime","MIN_POLL_INTERVAL","minPollInterval","MAX_POLL_INTERVAL","maxPollInterval","query","timeFrom","timeTo","sid","createSearchJob","then","result","waitForJobFinish","status","getSearchJobResult","response","results","waitForJobResultPreview","exec_mode","getSearchJobStatus","isDone","interval","getRandomInterval","Promise","resolve","setTimeout","getSearchJobResultPreview","length","timeRange","subject","previewResults","catch","console","log","error","next","complete","job","dispatchState","waitForPreview","search","namespace","endpoint","data","formatSearch","earliest_time","latest_time","auto_cancel","status_buckets","id","_post","action","_get","entry","content","params","count","name","encodeURI","getMetrics","resource","output_mode","method","headers","datasourceRequest","handleSplunkApiRequestError","messages","type","reject","text","err","cancelled","message","config","statusText","min","max","Math","floor","random","isGeneratingCommand","GENERATING_COMMAND_PATTERN","test","angular","module","factory"],"mappings":"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","file":"splunk_api.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nexport function splunkAPIFactory($httpParamSerializerJQLike, backendSrv) {\n\n  class SplunkAPI {\n\n    constructor(instanceSettings) {\n      let options = instanceSettings.jsonData;\n      this.url = instanceSettings.url;\n\n      this.basicAuth = instanceSettings.basicAuth;\n      this.withCredentials = instanceSettings.withCredentials;\n\n      this.paramSerializer = $httpParamSerializerJQLike;\n      this.backendSrv = backendSrv;\n\n      this.AUTO_CANCEL = _.isNumber(options.autoCancel) ? options.autoCancel : 30;\n      this.STATUS_BUCKETS = _.isNumber(options.statusBuckets) ? options.statusBuckets : 300;\n      this.DEFAULT_EARLIEST_TIME = options.defaultEarliestTime || '-1hr';\n\n      // Search result polling intervals. Interval for next poll choosing randomly\n      // from [MIN_POLL_INTERVAL, MAX_POLL_INTERVAL]\n      this.MIN_POLL_INTERVAL = options.minPollInterval || 500;\n      this.MAX_POLL_INTERVAL = options.maxPollInterval || 3000;\n    }\n\n    invokeAsyncSearch(query, timeFrom, timeTo, sid, options = {}) {\n      return this.createSearchJob(query, options, timeFrom, timeTo, sid)\n      .then(result => {\n        let sid = result.sid;\n        return this.waitForJobFinish(sid);\n      })\n      .then(result => {\n        if (result.status === 'done') {\n          return this.getSearchJobResult(result.sid);\n        } else {\n          return [];\n        }\n      })\n      .then(response => {\n        if (response && response.results) {\n          return response.results;\n        } else {\n          // Return empty result if job was canceled\n          return [];\n        }\n      });\n    }\n\n    invokeAsyncSearchWithFullResult(query, timeFrom, timeTo, sid, options = {}) {\n      return this.createSearchJob(query, options, timeFrom, timeTo, sid)\n      .then(result => {\n        let sid = result.sid;\n        return this.waitForJobFinish(sid);\n      })\n      .then(result => {\n        if (result.status === 'done') {\n          return this.getSearchJobResult(result.sid);\n        } else {\n          return [];\n        }\n      });\n    }\n\n    invokeSearchWithPreview(query, timeFrom, timeTo, sid, options = {}) {\n      return this.createSearchJob(query, options, timeFrom, timeTo, sid)\n      .then(result => {\n        let sid = result.sid;\n        return this.waitForJobResultPreview(sid);\n      })\n      .then(response => {\n        if (response && response.results) {\n          return response.results;\n        } else {\n          // Return empty result if job was canceled\n          return [];\n        }\n      });\n\n    }\n\n    invokeBlockingSearch(query, timeFrom, timeTo, sid, options = {}) {\n      options.exec_mode = 'oneshot';\n\n      return this.createSearchJob(query, options, timeFrom, timeTo, sid)\n      .then(response => {\n        if (response && response.results) {\n          return response.results;\n        } else {\n          // Return empty result if job was canceled\n          return [];\n        }\n      });\n    }\n\n    waitForJobFinish(sid) {\n      return this.getSearchJobStatus(sid)\n      .then(status => {\n        if (status.isDone) {\n          return {sid: sid, status: 'done'};\n        } else if (status === 'canceled') {\n          return {sid: sid, status: 'canceled'};\n        } else {\n          let interval = getRandomInterval(this.MIN_POLL_INTERVAL, this.MAX_POLL_INTERVAL);\n          return new Promise((resolve) => {\n            setTimeout(resolve, interval);\n          })\n          .then(() => {\n            return this.waitForJobFinish(sid);\n          });\n        }\n      });\n    }\n\n    waitForJobResultPreview(sid) {\n      return this.getSearchJobResultPreview(sid)\n      .then(result => {\n        if (result && result.results && result.results.length) {\n          return result;\n        } else {\n          let interval = getRandomInterval(this.MIN_POLL_INTERVAL, this.MAX_POLL_INTERVAL);\n          return new Promise((resolve) => {\n            setTimeout(resolve, interval);\n          })\n          .then(() => {\n            return this.waitForJobResultPreview(sid);\n          });\n        }\n      });\n    }\n\n    ////////////////////////\n    // Stream mode (RxJs) //\n    ////////////////////////\n\n    searchWithPreview(query, timeRange, subject, sid, options = {}) {\n      let {timeFrom, timeTo} = timeRange;\n\n      this.createSearchJob(query, options, timeFrom, timeTo, sid)\n      .then(result => {\n        return this.previewResults(result.sid, subject);\n      })\n      .catch(error => {\n        console.log(error);\n        subject.next([]);\n        subject.complete();\n        // TODO: improve error handling in Grafana\n        // subject.error(error);\n      });\n    }\n\n    /**\n     * Check for job status and get results preview using random inteval util\n     * job is finished.\n     * @param {*} sid\n     * @param {*} subject\n     */\n    previewResults(sid, subject) {\n      return this.getSearchJobStatus(sid)\n      .then(job => {\n        if (job.isDone || job.dispatchState === 'RUNNING') {\n          return this.getSearchJobResultPreview(sid)\n          .then(result => {\n            if (result && result.results) {\n              subject.next(result);\n            }\n\n            if (job.isDone) {\n              subject.complete();\n              return;\n            }\n\n            return this.waitForPreview(sid, subject);\n          });\n        } else {\n          return this.waitForPreview(sid, subject);\n        }\n      });\n    }\n\n    waitForPreview(sid, subject) {\n      let interval = getRandomInterval(this.MIN_POLL_INTERVAL, this.MAX_POLL_INTERVAL);\n      return new Promise((resolve) => {\n        setTimeout(resolve, interval);\n      }).then(() => {\n        return this.previewResults(sid, subject);\n      });\n    }\n\n    /////////////////\n    // Search Jobs //\n    /////////////////\n\n    createSearchJob(search, options, timeFrom, timeTo, sid) {\n      timeFrom = timeFrom || this.DEFAULT_EARLIEST_TIME;\n      let {exec_mode, namespace} = options;\n      let endpoint = '/services/search/jobs';\n\n      let data = {\n        search: formatSearch(search),\n        earliest_time: timeFrom,\n        latest_time: timeTo,\n        auto_cancel: this.AUTO_CANCEL,\n        status_buckets: this.STATUS_BUCKETS\n      };\n\n      if (exec_mode) {\n        data.exec_mode = exec_mode;\n      }\n\n      if (sid) {\n        data.id = sid;\n      }\n\n      if (namespace) {\n        data.namespace = namespace;\n        endpoint = `/servicesNS/-/${namespace}/search/jobs`;\n      }\n\n      return this._post(endpoint, data);\n    }\n\n    cancelSearchJob(sid) {\n      let data = {\n        action: 'cancel'\n      };\n\n      return this._post(`/services/search/jobs/${sid}/control`, data);\n    }\n\n    getSearchJobStatus(sid) {\n      return this._get('/services/search/jobs/' + sid)\n      .then(result => {\n        return result.entry[0].content;\n      })\n      .catch(() => {\n        return 'canceled';\n      });\n    }\n\n    getSearchJobResult(sid) {\n      let params = {\n        count: 0\n      };\n\n      return this._get('/services/search/jobs/' + sid + '/results', params)\n      .then(result => {\n        return result;\n      });\n    }\n\n    getSearchJobResultPreview(sid, count=0) {\n      let params = {\n        count: count\n      };\n\n      return this._get('/services/search/jobs/' + sid + '/results_preview', params)\n      .then(result => {\n        return result;\n      });\n    }\n\n    getSearchJobs() {\n      return this._get('/services/search/jobs')\n      .then(result => {\n        return result;\n      });\n    }\n\n    //////////////////////////\n    // API Methods Wrappers //\n    //////////////////////////\n\n    getServerStatus() {\n      return this._get('/services/server/status')\n      .then(result => {\n        return result;\n      });\n    }\n\n    getFiredAlerts(name) {\n      // Use '-' for name to return all fired alerts.\n      name = name ? encodeURI(name) : '-';\n\n      return this._get('/services/alerts/fired_alerts/' + name)\n      .then(result => {\n        if (result && result.entry) {\n          return result.entry;\n        } else {\n          return [];\n        }\n      })\n      .catch(() => {\n        // Alert with given name isn't existed\n        return [];\n      });\n    }\n\n    // Metric suggestions\n    getIndexes() {\n      return this.getMetrics('data/indexes');\n    }\n\n    getSourcetypes() {\n      return this.getMetrics('saved/sourcetypes');\n    }\n\n    getApps() {\n      return this.getMetrics('apps/local');\n    }\n\n    getMetrics(resource) {\n      let params = {\n        count: 0\n      };\n\n      return this._get('/services/' + resource, params)\n      .then(result => {\n        if (result && result.entry) {\n          return result.entry;\n        } else {\n          return [];\n        }\n      });\n    }\n\n    ///////////////////////////\n    // Core request wrappers //\n    ///////////////////////////\n\n    _get(url, params) {\n      params = params ? params : {};\n      params.output_mode = 'json';\n\n      let options = {\n        method: 'GET',\n        url: this.url + url,\n        params: params,\n      };\n\n      if (this.basicAuth || this.withCredentials) {\n        options.withCredentials = true;\n      }\n      if (this.basicAuth) {\n        options.headers = {\n          \"Authorization\": this.basicAuth\n        };\n      }\n\n      return this.backendSrv.datasourceRequest(options)\n      .then(response => {\n        return response.data;\n      })\n      .catch(handleSplunkApiRequestError);\n    }\n\n    _post(url, data) {\n      data.output_mode = 'json';\n\n      let options = {\n        method: 'POST',\n        url: this.url + url,\n        // Data should sent as Form Data and proper serialized\n        data: this.paramSerializer(data),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      };\n\n      if (this.basicAuth || this.withCredentials) {\n        options.withCredentials = true;\n      }\n      if (this.basicAuth) {\n        options.headers[\"Authorization\"] = this.basicAuth;\n      }\n\n      return this.backendSrv.datasourceRequest(options)\n      .then(response => {\n        let data = response.data;\n        if (data && data.messages && data.messages.length) {\n          let error = data.messages[0];\n          if (error.type === 'FATAL') {\n            return Promise.reject(error);\n          } else {\n            console.log(`${error.type}: ${error.text}`);\n          }\n        }\n\n        return data;\n      })\n      .catch(handleSplunkApiRequestError);\n    }\n  }\n\n  return SplunkAPI;\n}\n\nfunction handleSplunkApiRequestError(err) {\n  if (err.cancelled) {\n    err = err.err;\n    err.cancelled = true;\n  }\n\n  if (err.status !== 0 || err.status >= 300) {\n    if (err.data && err.data.messages && err.data.messages.length) {\n      let message = err.data.messages[0];\n      return Promise.reject({\n        message: `Splunk Error: ${message.type} ${message.text}`,\n        data: err.data,\n        config: err.config\n      });\n    } else {\n      return Promise.reject({\n        message: 'Network Error: ' + err.statusText + '(' + err.status + ')',\n        data: err.data,\n        config: err.config,\n        cancelled: err.cancelled\n      });\n    }\n  } else {\n    console.log(err);\n    return [];\n  }\n}\n\nfunction getRandomInterval(min, max) {\n  return Math.floor(Math.random() * (max - min)) + min;\n}\n\nconst GENERATING_COMMAND_PATTERN = /^\\s*\\|/;\n\nfunction isGeneratingCommand(query) {\n  return GENERATING_COMMAND_PATTERN.test(query);\n}\n\nexport function formatSearch(query) {\n  if (isGeneratingCommand(query)) {\n    return query;\n  } else {\n    return 'search ' + query;\n  }\n}\n\nangular\n  .module('grafana.services')\n  .factory('SplunkAPI', splunkAPIFactory);\n"]}